stages:
  - build
  - release

build:
  stage: build
  image: maven:3.8.1-openjdk-16
  before_script:
    - echo "EEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEEE $CI_JOB_ID"
    - echo "JOB=$CI_JOB_ID" >> build.env
  script: mvn clean package
  artifacts:
    name: "BoxedVillagers"
    paths:
    - "target/*.jar"
    exclude:
      - "target/original*.jar"
    reports:
      dotenv: build.env

release:
  stage: release
  image: registry.gitlab.com/gitlab-org/release-cli:latest
  script: echo "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA ${JOB}"
  rules:
    - if: $CI_COMMIT_TAG
  needs:
    - job: build
      artifacts: true
  release:
    name: "Boxed Villagers $CI_COMMIT_TAG"
    tag_name: $CI_COMMIT_TAG
    description: "Automatically Generated Release"
    assets:
      links:
        - name: "Plugin JAR"
          url: "https://gitlab.com/eggmc/boxedvillagers/-/jobs/${JOB}/artifacts/file/target/BoxedVillagers-1.0-SNAPSHOT.jar"